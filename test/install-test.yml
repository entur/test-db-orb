version: 2.1

#Include this in your config.yml
#orbs:
#  test-db: entur/test-db@dev:refactor-test-db # Use volatile if you always want the newest version.
orbs:
  gcp-auth: entur/gcp-auth@volatile
jobs:
  test-test-db-orb:
    executor: test-db/buildpack-deps
    steps:
      - test-db/database-build:
          image-name-suffix: test
          checkout: true
          setup-remote-docker: true
          database-type: "mysql"
          database-version: "8"
          database-schema: ./test/all_db.sql
          docker-login-steps:
            #- gcp-auth/authenticate-gcp: #TODO: necessary? 
            #    gcp-service-key: $DOCKER_PASSWORD
            - run: docker login -u _json_key --password-stdin https://eu.gcr.io < ${HOME}/account-auth.json
      # next job, you can use
workflows:
  version: 2.1
  main:
    jobs:
      - test-test-db-orb:
          name: build #must be called build for the test to be run
          context: global
